<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<title>SK텔레시스</title>
</head>
<body>
<script type='text/javascript' src='https://www.google.com/jsapi'></script>
<script type='text/javascript'>

window.onload = function(){
	setInterval(checkTemperature, 1000);
}

google.load('visualization', '1.1', {packages: ['line']});
google.setOnLoadCallback(drawChart);

var boundary;
var setflag=false;
var temparr=new Array();
var datearr=new Array();

function getRandomInt(max, min){
	return Math.floor((Math.random()*(max-min) + min)*10)/10;
}

function checkTemperature(){
	var temperature = getRandomInt(23,29);
	var date=new Date();

	temparr.push(temperature);
	datearr.push(date.getHours()+':'+date.getMinutes()+':'+date.getSeconds());

	if(!setflag){
		document.getElementById('boundarycheck').innerHTML='기준 온도를 설정해주세요.';
		document.getElementById('temperature').innerHTML=date.getFullYear()+'-'+date.getMonth()+'-'+date.getDay()+' '
		+date.getHours()+':'+date.getMinutes()+':'+date.getSeconds()+' '+temperature+'˚C';
	}
	else{
		boundary=Number(boundary);
		if(temperature>boundary){
			document.getElementById('boundarycheck').innerHTML='';
			document.getElementById('alert').innerHTML='기준 온도를 초과하였습니다.';
			document.getElementById('temperature').innerHTML='';
			document.getElementById('anomaly').innerHTML=date.getFullYear()+'-'+date.getMonth()+'-'+date.getDay()+' '
			+date.getHours()+':'+date.getMinutes()+':'+date.getSeconds()+' '+temperature+'˚C';
		}
		else{
			document.getElementById('boundarycheck').innerHTML='기준 온도가 '+boundary+'˚C로 설정되었습니다.';
			document.getElementById('alert').innerHTML='';
			document.getElementById('temperature').innerHTML=date.getFullYear()+'-'+date.getMonth()+'-'+date.getDay()+' '
			+date.getHours()+':'+date.getMinutes()+':'+date.getSeconds()+' '+temperature+'˚C';
			document.getElementById('anomaly').innerHTML='';
		}
	}
	drawChart();
}

function getBoundary(){
	setflag=true;
	boundary=document.getElementById('boundary').value;
	document.getElementById('boundarycheck').innerHTML='기준 온도가 '+boundary+'˚C로 설정되었습니다.';
}

function drawChart(){
	var data=new google.visualization.DataTable();
	var len=temparr.length;

	data.addColumn('string', '시간');
	data.addColumn('number', '온도');

	data.addRows([
		[datearr[len-15], temparr[len-15]], [datearr[len-14], temparr[len-14]], [datearr[len-13], temparr[len-13]], [datearr[len-12], temparr[len-12]], [datearr[len-11], temparr[len-11]],
		[datearr[len-10], temparr[len-10]], [datearr[len-9], temparr[len-9]], [datearr[len-8], temparr[len-8]], [datearr[len-7], temparr[len-7]], [datearr[len-6], temparr[len-6]],
		[datearr[len-5], temparr[len-5]], [datearr[len-4], temparr[len-4]], [datearr[len-3], temparr[len-3]], [datearr[len-2], temparr[len-2]], [datearr[len-1], temparr[len-1]]
	]);

	var option={
		width: 1000,
		height: 400,
		colors: ['orange']
	};

	var chart=new google.charts.Line(document.getElementById('chart'));
	chart.draw(data, option);
}

</script>
<h2>실시간 모니터링 시스템</h2>
<br>
기준 온도 <input type='text' id='boundary'> <input type='button' value='확인' onclick='getBoundary()'>
<p id='boundarycheck'></p>
<font color='red'><p id='alert'></p></font>
<h3><p id='temperature'></p></h3>
<font color='red'><h3><p id='anomaly'></p></h3></font>
<div id='chart'></div>
</body>
</html>